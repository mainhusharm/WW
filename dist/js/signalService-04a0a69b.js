import{a as t}from"./index-3aa40261.js";import"./vendor-react-core-24666f97.js";import"./vendor-aa89dd43.js";import"./vendor-animations-5318fd63.js";import"./polyfills-04934d90.js";import"./vendor-3d-61107973.js";import"./vendor-ui-8c022d9f.js";import"./vendor-react-libs-92d47a48.js";import"./vendor-utils-cc5cefda.js";import"./vendor-socket-c5f83ed8.js";class e{constructor(){this.signalQueue=[],this.isProcessing=!1,this.retryLimit=3,this.retryDelay=5e3,this.startProcessing()}static getInstance(){return e.instance||(e.instance=new e),e.instance}generateUniqueKey(t){const e=Math.floor(new Date(t.timestamp).getTime()/3e5),i=`${t.pair}_${t.timeframe||"unknown"}_${t.direction}_${t.entry}_${t.stopLoss}_${Array.isArray(t.takeProfit)?t.takeProfit.join("_"):t.takeProfit}_${e}`;let s=0;for(let r=0;r<i.length;r++){s=(s<<5)-s+i.charCodeAt(r),s&=s}return Math.abs(s).toString(36)}async addSignal(t){try{const e=this.generateUniqueKey(t);if(await this.checkSignalExists(e))return!1;const i={signalId:t.id,uniqueKey:e,signal:t,timestamp:(new Date).toISOString(),status:"pending",retryCount:0,lastAttempt:(new Date).toISOString()};return this.signalQueue.push(i),this.isProcessing||this.startProcessing(),!0}catch(e){return!1}}async checkSignalExists(e){try{return(await t.get(`/api/signals/check/${e}`)).data.exists}catch(i){return!1}}async startProcessing(){if(!this.isProcessing){for(this.isProcessing=!0;this.signalQueue.length>0;){const e=this.signalQueue.shift();if(e)try{await this.relaySignal(e)}catch(t){e.retryCount<this.retryLimit?(e.retryCount++,e.status="pending",e.lastAttempt=(new Date).toISOString(),setTimeout(()=>{this.signalQueue.push(e)},this.retryDelay*e.retryCount)):e.status="failed"}}this.isProcessing=!1}}async relaySignal(e){try{const i={symbol:e.signal.pair,side:"LONG"===e.signal.direction?"buy":"sell",entry_price:parseFloat(e.signal.entry.toString()),stop_loss:parseFloat(e.signal.stopLoss.toString()),take_profit:parseFloat(Array.isArray(e.signal.takeProfit)?e.signal.takeProfit[0].toString():e.signal.takeProfit.toString()),risk_tier:"medium",analysis:e.signal.analysis||"",confidence:e.signal.confidence||80},s=await t.post("/api/signals",i);if(201!==s.status)throw new Error(`Backend returned status ${s.status}`);e.status="delivered",this.broadcastSignal(e.signal)}catch(i){throw new Error(`Failed to relay signal: ${i}`)}}broadcastSignal(t){try{window.signalSocket&&window.signalSocket.readyState===WebSocket.OPEN&&window.signalSocket.send(JSON.stringify({type:"newSignal",signal:t}))}catch(e){}}getStats(){const t=this.signalQueue.filter(t=>"delivered"===t.status).length,e=this.signalQueue.filter(t=>"failed"===t.status).length,i=this.signalQueue.filter(t=>"pending"===t.status).length;return{queueLength:this.signalQueue.length,delivered:t,failed:e,pending:i}}clearFailedSignals(){this.signalQueue=this.signalQueue.filter(t=>"failed"!==t.status)}}const i=e.getInstance();export{i as default};
