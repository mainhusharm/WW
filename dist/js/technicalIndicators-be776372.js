const e=new class{constructor(){this.marketDataCache=new Map,this.cacheExpiry=new Map,this.CACHE_DURATION=6e4}async fetchMarketData(e,n="1h",a=100){const t=`${e}_${n}`,s=Date.now();if(this.marketDataCache.has(t)&&this.cacheExpiry.has(t)&&this.cacheExpiry.get(t)>s)return this.marketDataCache.get(t);try{const r=await fetch(`${{NEXT_PUBLIC_SUPABASE_URL:"https://dtowjuhwwoucuitzvhpn.supabase.co",NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0b3dqdWh3d291Y3VpdHp2aHBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMzI0NTUsImV4cCI6MjA4MTcwODQ1NX0.7o0oiXfaidstJeeMGlMiDObICD83VPE39IrTu_U78Qo",SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0b3dqdWh3d291Y3VpdHp2aHBuIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjEzMjQ1NSwiZXhwIjoyMDgxNzA4NDU1fQ.3XSkVOhIHR7KWUfwX-bQz4lW1y4GcGS0iStHiA2nGAQ",NODE_ENV:"production",FLASK_ENV:"production",FLASK_DEBUG:"false",PORT:"8080",CORS_ORIGINS:"*",DATABASE_URL:"postgresql://pghero_dpg_d2v9i7er433s73f0878g_a_cdm2_user:f2Q7RBmy1OeYVDdOvTTDos4TKNe0rd0V@dpg-d37pd8nfte5s73bfl1ug-a.oregon-postgres.render.com/pghero_dpg_d2v9i7er433s73f0878g_a_cdm2",TERM_PROGRAM:"vscode",NODE:"/opt/homebrew/Cellar/node/24.4.1/bin/node",INIT_CWD:"/Users/anchalsharma/Downloads/project",TERM:"xterm-256color",SHELL:"/bin/zsh",HOMEBREW_REPOSITORY:"/opt/homebrew",TMPDIR:"/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/",npm_config_global_prefix:"/opt/homebrew",TERM_PROGRAM_VERSION:"1.102.1",ZDOTDIR:"/Users/anchalsharma",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",MallocNanoZone:"0",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/anchalsharma/Downloads/project",USER:"anchalsharma",VSCODE_LOGIN_INITIALIZED:"1",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/opt/homebrew/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.0XKwE4uDMp/Listeners",VSCODE_PROFILE_INITIALIZED:"1",__CF_USER_TEXT_ENCODING:"0x1F5:0x0:0x0",npm_execpath:"/opt/homebrew/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/anchalsharma/Downloads/project/node_modules/.bin:/Users/anchalsharma/Downloads/node_modules/.bin:/Users/anchalsharma/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/opt/homebrew/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Library/Frameworks/Python.framework/Versions/3.14/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Library/Frameworks/Python.framework/Versions/3.14/bin:/Users/anchalsharma/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand",npm_package_json:"/Users/anchalsharma/Downloads/project/package.json",_:"/Users/anchalsharma/Downloads/project/node_modules/.bin/vite",LaunchInstanceID:"4E7E775B-7C77-4251-A6C3-7EF18C0FFAB7",npm_config_userconfig:"/Users/anchalsharma/.npmrc",npm_config_init_module:"/Users/anchalsharma/.npm-init.js",USER_ZDOTDIR:"/Users/anchalsharma",__CFBundleIdentifier:"com.microsoft.VSCode",npm_command:"run",PWD:"/Users/anchalsharma/Downloads/project",npm_lifecycle_event:"build",EDITOR:"vi",npm_package_name:"trading-platform",LANG:"en_US.UTF-8",PYTHONSTARTUP:"/Users/anchalsharma/Library/Application Support/Code/User/workspaceStorage/8fdf277a77e33063e6525c489ac28484/ms-python.python/pythonrc.py",npm_config_npm_version:"11.4.2",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",XPC_FLAGS:"0x0",npm_config_node_gyp:"/opt/homebrew/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",npm_package_version:"1.0.0",XPC_SERVICE_NAME:"0",VSCODE_INJECTION:"1",SHLVL:"2",HOME:"/Users/anchalsharma",VSCODE_GIT_ASKPASS_MAIN:"/private/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/AppTranslocation/CA96F8A5-FE96-4DEA-86AA-AC5037F0FA2D/d/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",PYTHON_BASIC_REPL:"1",HOMEBREW_PREFIX:"/opt/homebrew",CLINE_ACTIVE:"true",npm_config_cache:"/Users/anchalsharma/.npm",LOGNAME:"anchalsharma",npm_lifecycle_script:"vite build",VSCODE_GIT_IPC_HANDLE:"/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/vscode-git-2c088b0292.sock",npm_config_user_agent:"npm/11.4.2 node/v24.4.1 darwin arm64 workspaces/false",VSCODE_GIT_ASKPASS_NODE:"/private/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/AppTranslocation/CA96F8A5-FE96-4DEA-86AA-AC5037F0FA2D/d/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",GIT_ASKPASS:"/private/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/AppTranslocation/CA96F8A5-FE96-4DEA-86AA-AC5037F0FA2D/d/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",INFOPATH:"/opt/homebrew/share/info:/opt/homebrew/share/info:",HOMEBREW_CELLAR:"/opt/homebrew/Cellar",SECURITYSESSIONID:"186a4",npm_node_execpath:"/opt/homebrew/Cellar/node/24.4.1/bin/node",npm_config_prefix:"/opt/homebrew",COLORTERM:"truecolor",VITE_USER_NODE_ENV:"production"}.REACT_APP_API_BASE_URL}/market-data/${e}?timeframe=${n}&limit=${a}`);if(!r.ok)throw new Error(`Failed to fetch market data: ${r.status}`);const o=await r.json(),i={symbol:e,timeframe:n,open:o.candles.map(e=>parseFloat(e.open)),high:o.candles.map(e=>parseFloat(e.high)),low:o.candles.map(e=>parseFloat(e.low)),close:o.candles.map(e=>parseFloat(e.close)),volume:o.candles.map(e=>parseFloat(e.volume||0)),timestamp:o.candles.map(e=>new Date(e.timestamp).getTime())};return this.marketDataCache.set(t,i),this.cacheExpiry.set(t,s+this.CACHE_DURATION),i}catch(r){throw r}}calculateRSI(e,n=14){if(e.length<n+1)return 50;let a=0,t=0;for(let o=1;o<=n;o++){const n=e[o]-e[o-1];n>0?a+=n:t-=n}let s=a/n,r=t/n;for(let o=n+1;o<e.length;o++){const a=e[o]-e[o-1];s=(s*(n-1)+(a>0?a:0))/n,r=(r*(n-1)+(a<0?-a:0))/n}if(0===r)return 100;return 100-100/(1+s/r)}calculateMACD(e,n=12,a=26,t=9){if(e.length<a)return{macd:0,signal:0,histogram:0};const s=this.calculateEMA(e,n)-this.calculateEMA(e,a),r=[s],o=this.calculateEMA(r,t);return{macd:s,signal:o,histogram:s-o}}calculateEMA(e,n){if(0===e.length)return 0;if(e.length<n)return e[e.length-1];const a=2/(n+1);let t=e[0];for(let s=1;s<e.length;s++)t=e[s]*a+t*(1-a);return t}calculateATR(e,n,a,t=14){if(e.length<t+1)return 0;const s=[];for(let r=1;r<e.length;r++){const t=e[r]-n[r],o=Math.abs(e[r]-a[r-1]),i=Math.abs(n[r]-a[r-1]);s.push(Math.max(t,o,i))}return s.slice(-t).reduce((e,n)=>e+n,0)/t}calculateADX(e,n,a,t=14){if(e.length<t+1)return 0;const s=[],r=[],o=[];for(let p=1;p<e.length;p++){const t=e[p]-n[p],i=Math.abs(e[p]-a[p-1]),c=Math.abs(n[p]-a[p-1]);s.push(Math.max(t,i,c));const l=e[p]-e[p-1]>n[p-1]-n[p]?Math.max(e[p]-e[p-1],0):0,h=n[p-1]-n[p]>e[p]-e[p-1]?Math.max(n[p-1]-n[p],0):0;r.push(l),o.push(h)}const i=s.slice(-t).reduce((e,n)=>e+n,0)/t,c=r.slice(-t).reduce((e,n)=>e+n,0)/t/i*100,l=o.slice(-t).reduce((e,n)=>e+n,0)/t/i*100;return Math.abs(c-l)/(c+l)*100}async checkHTFTrendAlignment(e){try{const n=await this.fetchMarketData(e.pair,"4h",50),a=this.calculateEMA(n.close.slice(-20),20),t=this.calculateEMA(n.close.slice(-50),50),s=n.close[n.close.length-1],r=a>t&&s>a,o=a<t&&s<a,i=e.direction?.toLowerCase()||e.type?.toLowerCase(),c="long"===i&&r||"short"===i&&o;return{name:"HTF_trend",value:c,signal:r?"bullish":o?"bearish":"neutral",confidence:c?.8:.2}}catch(n){return{name:"HTF_trend",value:!1,signal:"neutral",confidence:0}}}async checkRSIConfirmation(e){try{const n=await this.fetchMarketData(e.pair,"1h",50),a=this.calculateRSI(n.close),t=e.direction?.toLowerCase()||e.type?.toLowerCase(),s=a<30,r=a>70;return{name:"RSI",value:a,signal:s?"bullish":r?"bearish":"neutral",confidence:"long"===t&&s||"short"===t&&r?.7:.3}}catch(n){return{name:"RSI",value:50,signal:"neutral",confidence:0}}}async checkMACDConfirmation(e){try{const n=await this.fetchMarketData(e.pair,"1h",50),a=this.calculateMACD(n.close),t=e.direction?.toLowerCase()||e.type?.toLowerCase(),s=a.histogram>0&&a.macd>a.signal,r=a.histogram<0&&a.macd<a.signal,o="long"===t&&s||"short"===t&&r;return{name:"MACD",value:a.histogram,signal:s?"bullish":r?"bearish":"neutral",confidence:o?.6:.2}}catch(n){return{name:"MACD",value:0,signal:"neutral",confidence:0}}}async checkEMAAlignment(e){try{const n=await this.fetchMarketData(e.pair,"1h",200),a=this.calculateEMA(n.close.slice(-20),20),t=this.calculateEMA(n.close.slice(-50),50),s=this.calculateEMA(n.close,200),r=n.close[n.close.length-1],o=e.direction?.toLowerCase()||e.type?.toLowerCase(),i=r>a&&a>t&&t>s,c=r<a&&a<t&&t<s,l="long"===o&&i||"short"===o&&c;return{name:"EMA_alignment",value:l,signal:i?"bullish":c?"bearish":"neutral",confidence:l?.75:.25}}catch(n){return{name:"EMA_alignment",value:!1,signal:"neutral",confidence:0}}}async checkATRFilter(e){try{const n=await this.fetchMarketData(e.pair,"1h",50),a=this.calculateATR(n.high,n.low,n.close),t=a/n.close[n.close.length-1]*100;return{name:"ATR_ok",value:t,signal:"neutral",confidence:t>=.5&&t<=3?.5:.1}}catch(n){return{name:"ATR_ok",value:0,signal:"neutral",confidence:0}}}async checkADXStrength(e){try{const n=await this.fetchMarketData(e.pair,"1h",50),a=this.calculateADX(n.high,n.low,n.close);return{name:"ADX",value:a,signal:"neutral",confidence:a>25?.6:.2}}catch(n){return{name:"ADX",value:0,signal:"neutral",confidence:0}}}checkTradingSession(e){const n=(new Date).getUTCHours(),a=n>=8&&n<=17||n>=13&&n<=22;return{name:"Session_ok",value:a,signal:"neutral",confidence:a?.4:.1}}async checkSpreadFilter(e){try{const e=2e-4;return{name:"Spread_ok",value:e,signal:"neutral",confidence:e<=5e-4?.3:.05}}catch(n){return{name:"Spread_ok",value:0,signal:"neutral",confidence:0}}}async evaluateAllConfirmations(e){const n=await Promise.all([this.checkHTFTrendAlignment(e),this.checkRSIConfirmation(e),this.checkMACDConfirmation(e),this.checkEMAAlignment(e),this.checkATRFilter(e),this.checkADXStrength(e),this.checkSpreadFilter(e)]);return n.push(this.checkTradingSession(e)),n}};export{e as default,e as technicalIndicators};
