import{aC as e,aD as s,aE as n}from"./vendor-aa89dd43.js";import"./vendor-react-core-24666f97.js";import"./polyfills-04934d90.js";import"./vendor-animations-5318fd63.js";import"./vendor-3d-61107973.js";const r={connectionString:"postgresql://pghero_dpg_d2v9i7er433s73f0878g_a_cdm2_user:f2Q7RBmy1OeYVDdOvTTDos4TKNe0rd0V@dpg-d37pd8nfte5s73bfl1ug-a.oregon-postgres.render.com/pghero_dpg_d2v9i7er433s73f0878g_a_cdm2",ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3};const a=new class{constructor(){this.pool=new e(r),this.pool.on("error",e=>{})}async getClient(){return await this.pool.connect()}async query(e,s){const n=await this.getClient();try{return await n.query(e,s)}finally{n.release()}}async createUser(e){const s=[e.email,e.password_hash,e.first_name||null,e.last_name||null,e.phone||null,e.country||null];return(await this.query("\n      INSERT INTO users (email, password_hash, first_name, last_name, phone, country)\n      VALUES ($1, $2, $3, $4, $5, $6)\n      RETURNING *\n    ",s)).rows[0]}async getUserByEmail(e){return(await this.query("SELECT * FROM users WHERE email = $1 AND status = $2",[e,"active"])).rows[0]||null}async getUserById(e){return(await this.query("SELECT * FROM users WHERE id = $1 AND status = $2",[e,"active"])).rows[0]||null}async updateUserLastLogin(e){await this.query("UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = $1",[e])}async createSubscription(e){const s=[e.user_id,e.plan_type,e.plan_name,e.amount,e.currency||"USD",e.billing_cycle,e.payment_method||null,e.payment_id||null,e.starts_at,e.expires_at||null];return(await this.query("\n      INSERT INTO user_subscriptions \n      (user_id, plan_type, plan_name, amount, currency, billing_cycle, payment_method, payment_id, starts_at, expires_at)\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)\n      RETURNING *\n    ",s)).rows[0]}async getUserActiveSubscription(e){return(await this.query("\n      SELECT * FROM user_subscriptions \n      WHERE user_id = $1 AND status = $2 \n      AND (expires_at IS NULL OR expires_at > CURRENT_TIMESTAMP)\n      ORDER BY created_at DESC \n      LIMIT 1\n    ",[e,"active"])).rows[0]||null}async saveQuestionnaire(e){const s=[e.user_id,e.account_equity,e.prop_firm_name||null,e.account_type,e.account_number||null,e.trading_experience||null,e.risk_tolerance||null,e.preferred_instruments||null,e.trading_goals||null,e.daily_risk_limit||null,e.max_drawdown_percent||null,e.preferred_session||null,e.additional_notes||null];return(await this.query("\n      INSERT INTO user_questionnaire \n      (user_id, account_equity, prop_firm_name, account_type, account_number, \n       trading_experience, risk_tolerance, preferred_instruments, trading_goals,\n       daily_risk_limit, max_drawdown_percent, preferred_session, additional_notes)\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13)\n      ON CONFLICT (user_id) DO UPDATE SET\n        account_equity = EXCLUDED.account_equity,\n        prop_firm_name = EXCLUDED.prop_firm_name,\n        account_type = EXCLUDED.account_type,\n        account_number = EXCLUDED.account_number,\n        trading_experience = EXCLUDED.trading_experience,\n        risk_tolerance = EXCLUDED.risk_tolerance,\n        preferred_instruments = EXCLUDED.preferred_instruments,\n        trading_goals = EXCLUDED.trading_goals,\n        daily_risk_limit = EXCLUDED.daily_risk_limit,\n        max_drawdown_percent = EXCLUDED.max_drawdown_percent,\n        preferred_session = EXCLUDED.preferred_session,\n        additional_notes = EXCLUDED.additional_notes,\n        updated_at = CURRENT_TIMESTAMP\n      RETURNING *\n    ",s)).rows[0]}async getUserQuestionnaire(e){return(await this.query("SELECT * FROM user_questionnaire WHERE user_id = $1",[e])).rows[0]||null}async getUserDashboardSettings(e){return(await this.query("SELECT * FROM user_dashboard_settings WHERE user_id = $1",[e])).rows[0]||null}async updateDashboardSettings(e,s){const n=Object.keys(s).filter(e=>"id"!==e&&"user_id"!==e&&"created_at"!==e).map((e,s)=>`${e} = $${s+2}`).join(", "),r=[e,...Object.values(s).filter((e,n)=>{const r=Object.keys(s)[n];return"id"!==r&&"user_id"!==r&&"created_at"!==r})],a=`\n      UPDATE user_dashboard_settings \n      SET ${n}, updated_at = CURRENT_TIMESTAMP\n      WHERE user_id = $1\n      RETURNING *\n    `;return(await this.query(a,r)).rows[0]}async getUserProfile(e){const s=await this.getUserById(e);if(!s)return null;const[n,r,a]=await Promise.all([this.getUserActiveSubscription(e),this.getUserQuestionnaire(e),this.getUserDashboardSettings(e)]);return{user:s,subscription:n,questionnaire:r,dashboardSettings:a}}async testConnection(){try{await this.query("SELECT NOW()");return!0}catch(e){return!1}}async close(){await this.pool.end()}},t={NEXT_PUBLIC_SUPABASE_URL:"https://dtowjuhwwoucuitzvhpn.supabase.co",NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0b3dqdWh3d291Y3VpdHp2aHBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMzI0NTUsImV4cCI6MjA4MTcwODQ1NX0.7o0oiXfaidstJeeMGlMiDObICD83VPE39IrTu_U78Qo",SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0b3dqdWh3d291Y3VpdHp2aHBuIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjEzMjQ1NSwiZXhwIjoyMDgxNzA4NDU1fQ.3XSkVOhIHR7KWUfwX-bQz4lW1y4GcGS0iStHiA2nGAQ",NODE_ENV:"production",FLASK_ENV:"production",FLASK_DEBUG:"false",PORT:"8080",CORS_ORIGINS:"*",DATABASE_URL:"postgresql://pghero_dpg_d2v9i7er433s73f0878g_a_cdm2_user:f2Q7RBmy1OeYVDdOvTTDos4TKNe0rd0V@dpg-d37pd8nfte5s73bfl1ug-a.oregon-postgres.render.com/pghero_dpg_d2v9i7er433s73f0878g_a_cdm2",TERM_PROGRAM:"vscode",NODE:"/opt/homebrew/Cellar/node/24.4.1/bin/node",INIT_CWD:"/Users/anchalsharma/Downloads/project",TERM:"xterm-256color",SHELL:"/bin/zsh",HOMEBREW_REPOSITORY:"/opt/homebrew",TMPDIR:"/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/",npm_config_global_prefix:"/opt/homebrew",TERM_PROGRAM_VERSION:"1.102.1",ZDOTDIR:"/Users/anchalsharma",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",MallocNanoZone:"0",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/anchalsharma/Downloads/project",USER:"anchalsharma",VSCODE_LOGIN_INITIALIZED:"1",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/opt/homebrew/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.0XKwE4uDMp/Listeners",VSCODE_PROFILE_INITIALIZED:"1",__CF_USER_TEXT_ENCODING:"0x1F5:0x0:0x0",npm_execpath:"/opt/homebrew/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/anchalsharma/Downloads/project/node_modules/.bin:/Users/anchalsharma/Downloads/node_modules/.bin:/Users/anchalsharma/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/opt/homebrew/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Library/Frameworks/Python.framework/Versions/3.14/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Library/Frameworks/Python.framework/Versions/3.14/bin:/Users/anchalsharma/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand",npm_package_json:"/Users/anchalsharma/Downloads/project/package.json",_:"/Users/anchalsharma/Downloads/project/node_modules/.bin/vite",LaunchInstanceID:"4E7E775B-7C77-4251-A6C3-7EF18C0FFAB7",npm_config_userconfig:"/Users/anchalsharma/.npmrc",npm_config_init_module:"/Users/anchalsharma/.npm-init.js",USER_ZDOTDIR:"/Users/anchalsharma",__CFBundleIdentifier:"com.microsoft.VSCode",npm_command:"run",PWD:"/Users/anchalsharma/Downloads/project",npm_lifecycle_event:"build",EDITOR:"vi",npm_package_name:"trading-platform",LANG:"en_US.UTF-8",PYTHONSTARTUP:"/Users/anchalsharma/Library/Application Support/Code/User/workspaceStorage/8fdf277a77e33063e6525c489ac28484/ms-python.python/pythonrc.py",npm_config_npm_version:"11.4.2",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",XPC_FLAGS:"0x0",npm_config_node_gyp:"/opt/homebrew/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",npm_package_version:"1.0.0",XPC_SERVICE_NAME:"0",VSCODE_INJECTION:"1",SHLVL:"2",HOME:"/Users/anchalsharma",VSCODE_GIT_ASKPASS_MAIN:"/private/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/AppTranslocation/CA96F8A5-FE96-4DEA-86AA-AC5037F0FA2D/d/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",PYTHON_BASIC_REPL:"1",HOMEBREW_PREFIX:"/opt/homebrew",CLINE_ACTIVE:"true",npm_config_cache:"/Users/anchalsharma/.npm",LOGNAME:"anchalsharma",npm_lifecycle_script:"vite build",VSCODE_GIT_IPC_HANDLE:"/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/vscode-git-2c088b0292.sock",npm_config_user_agent:"npm/11.4.2 node/v24.4.1 darwin arm64 workspaces/false",VSCODE_GIT_ASKPASS_NODE:"/private/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/AppTranslocation/CA96F8A5-FE96-4DEA-86AA-AC5037F0FA2D/d/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",GIT_ASKPASS:"/private/var/folders/1z/vp_g8y3j2xsg8njqcbqb626c0000gn/T/AppTranslocation/CA96F8A5-FE96-4DEA-86AA-AC5037F0FA2D/d/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",INFOPATH:"/opt/homebrew/share/info:/opt/homebrew/share/info:",HOMEBREW_CELLAR:"/opt/homebrew/Cellar",SECURITYSESSIONID:"186a4",npm_node_execpath:"/opt/homebrew/Cellar/node/24.4.1/bin/node",npm_config_prefix:"/opt/homebrew",COLORTERM:"truecolor",VITE_USER_NODE_ENV:"production"}.JWT_SECRET||"your-secret-key-change-in-production";const i=new class{async signup(e){try{if(await a.getUserByEmail(e.email))return{success:!1,message:"User with this email already exists"};const r=12,i=await s.hash(e.password,r),o=await a.createUser({...e,password_hash:i}),c=n.sign({userId:o.id,email:o.email},t,{expiresIn:"7d"});return{success:!0,user:{...o,password_hash:void 0},token:c}}catch(r){return{success:!1,message:"Internal server error during signup"}}}async login(e){try{const r=await a.getUserByEmail(e.email);if(!r)return{success:!1,message:"Invalid email or password"};if(!(await s.compare(e.password,r.password_hash)))return{success:!1,message:"Invalid email or password"};await a.updateUserLastLogin(r.id);const i=n.sign({userId:r.id,email:r.email},t,{expiresIn:"7d"});return{success:!0,user:{...r,password_hash:void 0},token:i}}catch(r){return{success:!1,message:"Internal server error during login"}}}async processPayment(e){try{if(!(await a.getUserById(e.user_id)))return{success:!1,message:"User not found"};return{success:!0,subscription:await a.createSubscription(e)}}catch(s){return{success:!1,message:"Internal server error during payment processing"}}}async saveQuestionnaire(e){try{if(!(await a.getUserById(e.user_id)))return{success:!1,message:"User not found"};const s=await a.saveQuestionnaire(e);return{success:!0,questionnaire:s,dashboardSettings:await a.getUserDashboardSettings(e.user_id)}}catch(s){return{success:!1,message:"Internal server error while saving questionnaire"}}}async getUserProfile(e){try{const s=await a.getUserProfile(e);if(!s)return{success:!1,message:"User not found"};return{success:!0,profile:{...s,user:{...s.user,password_hash:void 0}}}}catch(s){return{success:!1,message:"Internal server error while fetching user profile"}}}async updateDashboardSettings(e,s){try{if(!(await a.getUserById(e)))return{success:!1,message:"User not found"};return{success:!0,dashboardSettings:await a.updateDashboardSettings(e,s)}}catch(n){return{success:!1,message:"Internal server error while updating dashboard settings"}}}verifyToken(e){try{const s=n.verify(e,t);return{valid:!0,userId:s.userId,email:s.email}}catch(s){return{valid:!1}}}getMilestoneAccessLevel(e){switch(e){case"Demo":case"Beginner":default:return 1;case"Standard":return 2;case"Pro":case"Experienced":return 3;case"Funded":case"Evaluation":return 4}}async testConnection(){try{const e=await a.testConnection();return{success:e,message:e?"Database connection successful":"Database connection failed"}}catch(e){return{success:!1,message:`Database connection error: ${e}`}}}};export{i as default,i as userApiService};
