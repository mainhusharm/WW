<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Signal Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .container {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .error {
            background-color: #4a1a1a;
            color: #ff6b6b;
        }
        .success {
            background-color: #1a4a1a;
            color: #6bff6b;
        }
        .signal {
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Simple Signal Test</h1>
    
    <div class="container">
        <h2>Test 1: Fetch Signals from Backend</h2>
        <button onclick="fetchSignals()">Fetch Signals</button>
        <div id="signalsResult" class="result" style="display: none;"></div>
        <div id="signalsList"></div>
    </div>

    <div class="container">
        <h2>Test 2: Generate New Signal</h2>
        <button onclick="generateSignal()">Generate New Signal</button>
        <div id="generateResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>Test 3: Test Customer Database</h2>
        <button onclick="testCustomers()">Test Customer Database</button>
        <div id="customersResult" class="result" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = 'https://backend-ox9b.onrender.com/api';

        async function fetchSignals() {
            const resultDiv = document.getElementById('signalsResult');
            const signalsListDiv = document.getElementById('signalsList');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Fetching signals...';

            try {
                const response = await fetch(`${API_BASE}/signals/admin`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `✅ Signals fetched successfully!\n\nTotal: ${data.total}`;
                    
                    if (data.signals && data.signals.length > 0) {
                        signalsListDiv.innerHTML = `<h3>Signals (${data.total}):</h3>`;
                        data.signals.forEach(signal => {
                            const signalDiv = document.createElement('div');
                            signalDiv.className = 'signal';
                            signalDiv.innerHTML = `
                                <div><strong>${signal.symbol}</strong> - ${signal.action}</div>
                                <div>Entry: $${signal.entryPrice} | Stop: $${signal.stopLoss} | Target: $${signal.takeProfit}</div>
                                <div>Confidence: ${signal.confidence}% | R:R: ${signal.rrRatio}</div>
                                <div>Created: ${new Date(signal.createdAt).toLocaleString()} by ${signal.createdBy}</div>
                                <div>Description: ${signal.description}</div>
                            `;
                            signalsListDiv.appendChild(signalDiv);
                        });
                    } else {
                        signalsListDiv.innerHTML = '<p>No signals found.</p>';
                    }
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `❌ Failed to fetch signals:\n\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function generateSignal() {
            const resultDiv = document.getElementById('generateResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Generating signal...';

            try {
                const signalData = {
                    symbol: 'GBP/USD',
                    action: 'SELL',
                    entryPrice: 1.2650,
                    stopLoss: 1.2700,
                    takeProfit: 1.2550,
                    timeframe: '1H',
                    description: 'Simple test signal',
                    confidence: 85,
                    rrRatio: '1:3.0',
                    analysis: 'Simple test analysis',
                    marketSession: 'London',
                    economicImpact: 'Medium'
                };

                const response = await fetch(`${API_BASE}/admin/forex/generate-signal`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(signalData)
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `✅ Signal generated successfully!\n\n${JSON.stringify(data, null, 2)}`;
                    
                    // Refresh signals list
                    setTimeout(fetchSignals, 1000);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `❌ Failed to generate signal:\n\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        async function testCustomers() {
            const resultDiv = document.getElementById('customersResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Testing customer database...';

            try {
                const response = await fetch(`${API_BASE}/payment/customers`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `✅ Customer database working!\n\nTotal customers: ${data.total}\n\n${JSON.stringify(data.customers, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `❌ Customer database failed:\n\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        // Load signals on page load
        window.onload = function() {
            fetchSignals();
            testCustomers();
        };
    </script>
</body>
</html>
