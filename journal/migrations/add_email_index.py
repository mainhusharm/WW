\n"""\nMigration script to add an index to the email column of the users table.\n"""\nfrom sqlalchemy import create_engine, text, inspect\nfrom sqlalchemy.orm import sessionmaker\nimport os\n\ndef add_email_index():\n    """Add an index to the email column of the users table if it doesn\'t exist."""\n\n    # Database connection\n    database_url = os.getenv(\'DATABASE_URL\', \'sqlite:///journal.db\')\n    if not database_url:\n        print("DATABASE_URL environment variable is not set.")\n        return\n\n    engine = create_engine(database_url)\n    inspector = inspect(engine)\n    Session = sessionmaker(bind=engine)\n    session = Session()\n\n    try:\n        # Get existing indexes for the \'users\' table\n        indexes = inspector.get_indexes(\'users\')\n        email_index_exists = False\n        for index in indexes:\n            if \'email\' in index[\'column_names\']:\n                email_index_exists = True\n                print("Index on \'email\' column already exists.")\n                break\n\n        if not email_index_exists:\n            print("Index on \'email\' column does not exist. Creating it now.")\n            # Use different SQL for PostgreSQL and SQLite\n            if \'sqlite\' in database_url.lower():\n                session.execute(text("CREATE INDEX IF NOT EXISTS ix_users_email ON users (email)"))\n                print("Created index \'ix_users_email\' on \'users(email)\` for SQLite.")\n            else: # Assuming PostgreSQL\n                session.execute(text("CREATE INDEX IF NOT EXISTS ix_users_email ON users (email)"))\n                print("Created index \'ix_users_email\' on \'users(email)\` for PostgreSQL.")\n\n            session.commit()\n            print("Migration to add email index completed successfully.")\n        else:\n            print("Migration not needed as index already exists.")\n\n    except Exception as e:\n        session.rollback()\n        print(f"Migration failed: {str(e)}")\n        raise\n    finally:\n        session.close()\n\nif __name__ == \'__main__\':\n    add_email_index()\n