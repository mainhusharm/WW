<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Questionnaire - TradeEdge Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .questionnaire-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 50px auto;
            padding: 40px;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .progress-bar {
            background: rgba(51, 65, 85, 0.8);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 40px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-section {
            margin-bottom: 30px;
        }

        .question-title {
            color: #e2e8f0;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #e2e8f0;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(51, 65, 85, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 10px;
            color: #ffffff;
            font-size: 0.95rem;
        }

        .asset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .asset-option {
            background: rgba(51, 65, 85, 0.8);
            border: 2px solid rgba(148, 163, 184, 0.3);
            border-radius: 8px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #e2e8f0;
            font-weight: 500;
        }

        .asset-option:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .asset-option.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
        }

        .risk-slider {
            margin: 20px 0;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(51, 65, 85, 0.8);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }

        .risk-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            padding: 12px 16px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .success-message {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        @media (max-width: 768px) {
            .questionnaire-container {
                margin: 20px;
                padding: 30px 20px;
            }

            .asset-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="questionnaire-container">
        <div class="header">
            <h1>üéØ Trading Setup Questionnaire</h1>
            <div class="subtitle">Help us customize your trading experience</div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <form id="questionnaireForm">
            <div class="question-section">
                <div class="question-title">1. Which prop firm are you trading with?</div>
                <div class="form-group">
                    <select id="propFirm" name="propFirm" required>
                        <option value="">Select your prop firm</option>
                        <option value="FTMO">FTMO</option>
                        <option value="MyForexFunds">MyForexFunds</option>
                        <option value="FundedNext">FundedNext</option>
                        <option value="The5ers">The5ers</option>
                        <option value="TopstepTrader">TopstepTrader</option>
                        <option value="SurgeTrader">SurgeTrader</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>

            <div class="question-section">
                <div class="question-title">2. What type of account are you using?</div>
                <div class="form-group">
                    <select id="accountType" name="accountType" required>
                        <option value="">Select account type</option>
                        <option value="demo">Demo Account</option>
                        <option value="challenge">Challenge Account</option>
                        <option value="funded">Funded Account</option>
                        <option value="live">Live Account</option>
                    </select>
                </div>
            </div>

            <div class="question-section">
                <div class="question-title">3. What's your account size?</div>
                <div class="form-group">
                    <select id="accountSize" name="accountSize" required>
                        <option value="">Select account size</option>
                        <option value="$5K - $10K">$5K - $10K</option>
                        <option value="$10K - $50K">$10K - $50K</option>
                        <option value="$50K - $100K">$50K - $100K</option>
                        <option value="$100K+">$100K+</option>
                    </select>
                </div>
            </div>

            <div class="question-section">
                <div class="question-title">4. Risk Management Settings</div>
                <div class="form-group">
                    <label>Maximum Risk Per Trade (%)</label>
                    <div class="risk-slider">
                        <input type="range" id="riskPerTrade" class="slider" min="0.5" max="5" step="0.1" value="1">
                        <div class="risk-labels">
                            <span>0.5%</span>
                            <span id="riskValue">1%</span>
                            <span>5%</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Daily Loss Limit (%)</label>
                    <select id="dailyLossLimit" name="dailyLossLimit">
                        <option value="3">3%</option>
                        <option value="5" selected>5%</option>
                        <option value="8">8%</option>
                        <option value="10">10%</option>
                    </select>
                </div>
            </div>

            <div class="question-section">
                <div class="question-title">5. Trading Preferences</div>
                <div class="form-group">
                    <label>Preferred Trading Session</label>
                    <select id="tradingSession" name="tradingSession">
                        <option value="london">London Session</option>
                        <option value="newyork" selected>New York Session</option>
                        <option value="asian">Asian Session</option>
                        <option value="overlap">Session Overlaps</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Trading Style</label>
                    <select id="tradingStyle" name="tradingStyle">
                        <option value="scalping">Scalping</option>
                        <option value="daytrading" selected>Day Trading</option>
                        <option value="swing">Swing Trading</option>
                        <option value="position">Position Trading</option>
                    </select>
                </div>
            </div>

            <div class="question-section">
                <div class="question-title">6. Asset Selection</div>
                <div class="form-group">
                    <label>Select your preferred trading assets (multiple selection allowed)</label>
                    <div class="asset-grid">
                        <div class="asset-option" onclick="toggleAsset('EURUSD')">EUR/USD</div>
                        <div class="asset-option" onclick="toggleAsset('GBPUSD')">GBP/USD</div>
                        <div class="asset-option" onclick="toggleAsset('USDJPY')">USD/JPY</div>
                        <div class="asset-option" onclick="toggleAsset('AUDUSD')">AUD/USD</div>
                        <div class="asset-option" onclick="toggleAsset('USDCAD')">USD/CAD</div>
                        <div class="asset-option" onclick="toggleAsset('NZDUSD')">NZD/USD</div>
                        <div class="asset-option" onclick="toggleAsset('GOLD')">GOLD</div>
                        <div class="asset-option" onclick="toggleAsset('SILVER')">SILVER</div>
                        <div class="asset-option" onclick="toggleAsset('OIL')">OIL</div>
                        <div class="asset-option" onclick="toggleAsset('BTC')">BTC/USD</div>
                        <div class="asset-option" onclick="toggleAsset('ETH')">ETH/USD</div>
                        <div class="asset-option" onclick="toggleAsset('SPX500')">SPX500</div>
                    </div>
                </div>
            </div>

            <div class="question-section">
                <div class="question-title">7. Account Details (Optional)</div>
                <div class="form-group">
                    <label>Account Number</label>
                    <input type="text" id="accountNumber" name="accountNumber" placeholder="Enter your account number">
                </div>
            </div>

            <div id="message" class="message" style="display: none;"></div>

            <button type="submit" class="submit-btn" id="submitBtn">
                Complete Setup & Access Dashboard
            </button>
        </form>
    </div>

    <script>
        let selectedAssets = [];
        let formProgress = 0;

        // Update progress bar
        function updateProgress() {
            const form = document.getElementById('questionnaireForm');
            const requiredFields = form.querySelectorAll('[required]');
            let filledFields = 0;

            requiredFields.forEach(field => {
                if (field.value) filledFields++;
            });

            formProgress = (filledFields / requiredFields.length) * 100;
            document.getElementById('progressFill').style.width = formProgress + '%';
        }

        // Toggle asset selection
        function toggleAsset(asset) {
            const element = event.target;
            
            if (selectedAssets.includes(asset)) {
                selectedAssets = selectedAssets.filter(a => a !== asset);
                element.classList.remove('selected');
            } else {
                selectedAssets.push(asset);
                element.classList.add('selected');
            }
        }

        // Update risk slider value
        document.getElementById('riskPerTrade').addEventListener('input', function() {
            document.getElementById('riskValue').textContent = this.value + '%';
        });

        // Add event listeners for progress tracking
        document.querySelectorAll('select, input').forEach(element => {
            element.addEventListener('change', updateProgress);
        });

        // Handle form submission
        document.getElementById('questionnaireForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const messageEl = document.getElementById('message');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';

            try {
                // Collect form data
                const formData = new FormData(this);
                const questionnaireData = {
                    propFirm: formData.get('propFirm'),
                    accountType: formData.get('accountType'),
                    accountSize: formData.get('accountSize'),
                    riskManagement: {
                        riskPerTrade: document.getElementById('riskPerTrade').value,
                        dailyLossLimit: formData.get('dailyLossLimit')
                    },
                    tradingPreferences: {
                        tradingSession: formData.get('tradingSession'),
                        tradingStyle: formData.get('tradingStyle')
                    },
                    assetSelection: selectedAssets,
                    accountNumber: formData.get('accountNumber') || '',
                    timestamp: new Date().toISOString()
                };

                // Submit to backend
                const response = await fetch('https://backend-topb.onrender.com/api/questionnaire/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(questionnaireData)
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('‚úÖ Setup completed successfully! Redirecting to dashboard...', 'success');
                    
                    // Store user data for dashboard
                    localStorage.setItem('user_questionnaire_data', JSON.stringify(questionnaireData));
                    localStorage.setItem('milestone_access', result.milestone_access);
                    
                    setTimeout(() => {
                        window.location.href = '/dashboard/signals';
                    }, 2000);
                } else {
                    throw new Error(result.error || 'Questionnaire submission failed');
                }

            } catch (error) {
                console.error('Questionnaire submission error:', error);
                showMessage('‚ùå ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Complete Setup & Access Dashboard';
            }
        });

        function showMessage(message, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = message;
            messageEl.className = `message ${type}-message`;
            messageEl.style.display = 'block';
        }

        // Initialize progress
        updateProgress();
    </script>
</body>
</html>
